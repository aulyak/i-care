{"version":3,"file":"/js/view_witel.js","mappings":"soDAAA,IAAMA,EAAKC,MAAMC,SAkCjBC,EAAEC,UAAUC,OAAM,WAChBC,aAAY,WACV,IAAMC,EAAMP,EAAGO,MACTC,EAAoBD,EAAIE,eAAe,CAACC,QAAS,OAAQC,MAAO,OAAQC,IAAK,UAAWC,KAAM,YAC9FC,EAAYP,EAAIQ,SAAS,SAC/BZ,EAAE,SAASa,KAAKR,GAChBL,EAAE,SAASa,KAAKF,EAClB,GAAG,KAEH,IAAMG,EAAed,EAAE,gBAAgBe,KAAK,iBAC5CC,QAAQC,IAAI,CAACH,aAAAA,IACb,IAAMI,EAAYlB,EAAE,UAAUe,KAAK,SACnCC,QAAQC,IAAI,CAACC,UAAAA,IAEb,IAAMC,EAAiBC,OAAOC,OAAOP,GAC/BQ,EA9CS,EA8CiBH,EA9CTI,QAAO,SAACC,EAAGC,GAChC,IAAMC,EAAM,GAAH,OAAMD,EAAEE,MAAK,YAAIF,EAAEG,MAAK,YAAIH,EAAEI,SAEjCC,EAAON,EAAEO,IAAIL,IAAQN,OAAOY,OAAO,CAAC,EAAGP,EAAG,CAC9CQ,WAAY,IAKd,OAFAH,EAAKG,YAAcR,EAAES,MAEdV,EAAEW,IAAIT,EAAKI,EACpB,GAAG,IAAIM,KAAOf,UAqCRgB,EAAiBnB,EAAUoB,KAAI,SAAAR,GAAI,MAAK,CAC5Cf,KAAMe,EACNS,OAAQ,SAASxB,EAAMyB,EAAMC,GAC3B,OAAK1B,GAAa,EAGpB,EACD,IAEKA,EAAOO,EAAYgB,KAAI,SAACR,GAC5B,IACMY,EADkBxB,EAAUyB,QAAO,SAAAF,GAAG,OAAIA,IAAQX,EAAKF,KAAK,IACtCL,QAAO,SAACqB,EAAKC,GAAI,OAAMD,EAAIC,GAAQ,EAAGD,CAAG,GAAG,CAAC,GACzE,O,+VAAO,CAAP,GACEjB,MAAOG,EAAKH,MACZE,QAASC,EAAKD,SACbC,EAAKF,MAAQE,EAAKG,YAChBS,EAEP,IAEMI,EApDR,SAAeC,EAAK7B,GAalB,OAZe,EAAI6B,EAAIxB,QAAO,SAACC,EAAGC,GAChC,IAAMC,EAAM,GAAH,OAAMD,EAAEE,MAAK,YAAIF,EAAEI,SAEtBC,EAAON,EAAEO,IAAIL,IAAQN,OAAOY,OAAO,CAAC,EAAGP,EAAGP,EAAUK,QAAO,SAACqB,EAAKC,GAAI,OAAMD,EAAIC,GAAQ,EAAGD,CAAG,GAAG,CAAC,IAMvG,OAJA1B,EAAU8B,SAAQ,SAAApB,GAChBE,EAAKF,IAAUH,EAAEG,EACnB,IAEOJ,EAAEW,IAAIT,EAAKI,EACpB,GAAG,IAAIM,KAAOf,SAGhB,CAsCoB4B,CAAMlC,EAAMG,GAC9BF,QAAQC,IAAI,CAACF,KAAAA,EAAM+B,UAAAA,IAEnB,IAAMI,EAAU,CACd,CAACnC,KAAM,SACP,CAACA,KAAM,YAAU,SACdsB,IAGLrB,QAAQC,IAAI,CAACiC,QAAAA,IAEblD,EAAE,wBAAwBmD,UAAU,CAClCC,QAAQ,EACRC,IAAK,SACLtC,KAAM+B,EACNI,QAAAA,EAGAI,YAAY,EACZC,WAAW,EACXC,QAAS,CAAC,OAAQ,MAAO,QAAS,MAAO,QAAS,UAClDC,WAAY,SAAShB,EAAK1B,EAAM2C,EAAWC,GACzC3C,QAAQC,IAAI,CAACwB,IAAAA,EAAK1B,KAAAA,EAAM2C,UAAAA,EAAWC,MAAAA,IAChB,gBAAf5C,EAAKY,OAA0C,eAAfZ,EAAKY,OAAwB3B,EAAEyC,GAAKmB,IAAI,CAAC,mBAAoB,YAC9E,eAAf7C,EAAKY,OAAwB3B,EAAEyC,GAAKmB,IAAI,CAAC,mBAAoB,YAC9C,oBAAf7C,EAAKY,OAA6B3B,EAAEyC,GAAKmB,IAAI,CAAC,mBAAoB,UAAW,MAAS,UACvE,oBAAf7C,EAAKY,OAA6B3B,EAAEyC,GAAKmB,IAAI,CAAC,mBAAoB,UAAW,MAAS,UAE1F5D,EAAE2D,GAAOE,MAAK,SAASC,EAAKC,GACtB,CAAC,EAAG,GAAGC,SAASF,IAAM9D,EAAE+D,GAAMH,IAAI,CAAC,mBAAoB,QAAS,MAAS,SAC/E,GACF,EACAK,WAAY,CAAC,CACXC,QAAS,OACTC,YAAa,SAASC,EAAIC,EAAUC,EAAS7B,EAAK8B,GAChDvD,QAAQC,IAAI,CAACoD,SAAAA,IACI,IAAbA,GACFrE,EAAEoE,GAAIR,IAAI,mBAAoB,QAElC,KAGN,G","sources":["webpack:///./resources/js/view_witel.js"],"sourcesContent":["const dt = luxon.DateTime;\n\nfunction groupScores(arr) {\n  const result = [...arr.reduce((r, o) => {\n    const key = `${o.alert}-${o.witel}-${o.atribut}`;\n\n    const item = r.get(key) || Object.assign({}, o, {\n      totalScore: 0,\n    });\n\n    item.totalScore += o.score;\n\n    return r.set(key, item);\n  }, new Map()).values()];\n\n  return result;\n}\n\nfunction pivot(arr, witelList) {\n  const result = [...arr.reduce((r, o) => {\n    const key = `${o.alert}-${o.atribut}`;\n\n    const item = r.get(key) || Object.assign({}, o, witelList.reduce((acc, curr) => (acc[curr] = 0, acc), {}));\n\n    witelList.forEach(witel => {\n      item[witel] += o[witel];\n    });\n\n    return r.set(key, item);\n  }, new Map()).values()];\n\n  return result;\n}\n\n$(document).ready(function() {\n  setInterval(() => {\n    const now = dt.now();\n    const currentDtReadable = now.toLocaleString({weekday: 'long', month: 'long', day: '2-digit', year: 'numeric'});\n    const localTime = now.toFormat('HH:mm');\n    $('.date').text(currentDtReadable);\n    $('.time').text(localTime);\n  }, 1000);\n\n  const filteredData = $('#filter-form').data('filtered-data');\n  console.log({filteredData});\n  const witelList = $('.witel').data('witel');\n  console.log({witelList});\n\n  const filteredValues = Object.values(filteredData);\n  const groupedData = groupScores(filteredValues);\n  const witelArrHeader = witelList.map(item => ({\n    data: item,\n    render: function(data, type, row) {\n      if (!data) return '';\n\n      return data;\n    },\n  }));\n\n  const data = groupedData.map((item) => {\n    const excludingWitels = witelList.filter(row => row !== item.witel);\n    const tes = excludingWitels.reduce((acc, curr) => (acc[curr] = 0, acc), {});\n    return {\n      alert: item.alert,\n      atribut: item.atribut,\n      [item.witel]: item.totalScore,\n      ...tes\n    };\n  });\n\n  const pivotData = pivot(data, witelList);\n  console.log({data, pivotData});\n\n  const columns = [\n    {data: 'alert'},\n    {data: 'atribut'},\n    ...witelArrHeader\n  ];\n\n  console.log({columns});\n\n  $(\"#table-view-by-witel\").DataTable({\n    paging: false,\n    dom: \"Bfrtip\",\n    data: pivotData,\n    columns,\n    // columns: [],\n    // scrollX: true,\n    responsive: true,\n    autoWidth: false,\n    buttons: [\"copy\", \"csv\", \"excel\", \"pdf\", \"print\", \"colvis\"],\n    createdRow: function(row, data, dataIndex, cells) {\n      console.log({row, data, dataIndex, cells});\n      if (data.alert === 'BASIC ALERT' || data.alert === 'LEVERAGING') $(row).css({'background-color': '#69AC65'});\n      if (data.alert === 'HIGH ALERT') $(row).css({'background-color': '#F4D165'});\n      if (data.alert === 'VERY HIGH ALERT') $(row).css({'background-color': '#BE2A3E', 'color': 'white'});\n      if (data.alert === 'CHURN RETENTION') $(row).css({'background-color': '#DB5346', 'color': 'white'});\n\n      $(cells).each(function(idx, cell) {\n        if ([0, 1].includes(idx)) $(cell).css({'background-color': 'white', 'color': 'black'});\n      });\n    },\n    columnDefs: [{\n      targets: '_all',\n      createdCell: function(td, cellData, rowData, row, col) {\n        console.log({cellData});\n        if (cellData === 0) {\n          $(td).css('background-color', 'white');\n        }\n      }\n    }],\n  });\n});"],"names":["dt","luxon","DateTime","$","document","ready","setInterval","now","currentDtReadable","toLocaleString","weekday","month","day","year","localTime","toFormat","text","filteredData","data","console","log","witelList","filteredValues","Object","values","groupedData","reduce","r","o","key","alert","witel","atribut","item","get","assign","totalScore","score","set","Map","witelArrHeader","map","render","type","row","tes","filter","acc","curr","pivotData","arr","forEach","pivot","columns","DataTable","paging","dom","responsive","autoWidth","buttons","createdRow","dataIndex","cells","css","each","idx","cell","includes","columnDefs","targets","createdCell","td","cellData","rowData","col"],"sourceRoot":""}